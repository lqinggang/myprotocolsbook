(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{462:function(e,t,a){"use strict";a.r(t);var v=a(2),_=Object(v.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"sip协议之1-协议格式说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sip协议之1-协议格式说明"}},[e._v("#")]),e._v(" SIP协议之1-协议格式说明")]),e._v(" "),t("p",[e._v("sip 协议是一个基于文本的使用"),t("code",[e._v("UTF-8")]),e._v("字符集编码的协议，sip消息包括客户端到服务端的请求消息，以及服务端到客户端的响应消息")]),e._v(" "),t("h2",{attrs:{id:"协议组件说明"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#协议组件说明"}},[e._v("#")]),e._v(" 协议组件说明")]),e._v(" "),t("p",[e._v("sip 消息有"),t("strong",[e._v("一个起始行")]),e._v("，"),t("strong",[e._v("一个或多个消息头部字段")]),e._v("，"),t("strong",[e._v("一个用于指示消息头部字段结束的空行")]),e._v("以及"),t("strong",[e._v("可选的消息正文")]),e._v("，格式如下")]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v(" generic-message = start-line\n \t\t\t\t  *message-header\n \t\t\t\t  CRLF\n \t\t\t\t  [ message-body ]\n start-line = Request-Line / Status-Line\n")])])]),t("p",[e._v("其中，"),t("code",[e._v("start-line")]),e._v(", "),t("code",[e._v("message-header")]),e._v(", "),t("code",[e._v("CRLF")]),e._v("都是必须的(即使没有"),t("code",[e._v("mesage-body")]),e._v(", "),t("code",[e._v("message-header")]),e._v("后面也必须要跟一个"),t("code",[e._v("CRLF")]),e._v(")")]),e._v(" "),t("h2",{attrs:{id:"起始行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#起始行"}},[e._v("#")]),e._v(" 起始行")]),e._v(" "),t("p",[e._v("sip 消息的区分是具有一个作为起始行的请求行或者状态行，即起始行的格式可以用于区分是请求还是响应")]),e._v(" "),t("h3",{attrs:{id:"请求行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#请求行"}},[e._v("#")]),e._v(" 请求行")]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Request-Line = Method SP Request-URI SP SIP-Version CRLF\n")])])]),t("p",[e._v("这里的 "),t("code",[e._v("SP")]),e._v("表示空格，以"),t("code",[e._v("CRLF")]),e._v("作为结束标志。除末尾的"),t("code",[e._v("CRLF")]),e._v("之外，不允许带有其他的"),t("code",[e._v("CR")]),e._v("或者"),t("code",[e._v("LF")])]),e._v(" "),t("p",[e._v("一个请求行包括一个"),t("code",[e._v("Method")]),e._v("名，一个"),t("code",[e._v("Request-URI")]),e._v(" 以及一个协议版本，它们之间以空格分隔")]),e._v(" "),t("h4",{attrs:{id:"method"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#method"}},[e._v("#")]),e._v(" Method")]),e._v(" "),t("p",[e._v("sip 请求规范定义了如下 6 种方法："),t("code",[e._v("REGISTER")]),e._v("，"),t("code",[e._v("INVITE")]),e._v(", "),t("code",[e._v("ACK")]),e._v(", "),t("code",[e._v("CANCEL")]),e._v("，"),t("code",[e._v("BYE")]),e._v("，"),t("code",[e._v("OPTIONS")])]),e._v(" "),t("p",[e._v("其中，"),t("code",[e._v("REGISTER")]),e._v("请求用于登记联系信息，"),t("code",[e._v("INVITE")]),e._v(", "),t("code",[e._v("ACK")]),e._v(", "),t("code",[e._v("CANCEL")]),e._v("请求用于设置会话，"),t("code",[e._v("BYE")]),e._v("请求用于终止会话，"),t("code",[e._v("OPTIONS")]),e._v("用于查询服务器功能选项")]),e._v(" "),t("h4",{attrs:{id:"request-uri"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#request-uri"}},[e._v("#")]),e._v(" Request-URI")]),e._v(" "),t("p",[t("code",[e._v("request-uri")]),e._v(" 用于指示该请求所针对的用户或服务, "),t("code",[e._v("request-uri")]),e._v("不能包含未转义的空格，控制字符以及"),t("code",[e._v("<>")])]),e._v(" "),t("h4",{attrs:{id:"sip-version"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sip-version"}},[e._v("#")]),e._v(" SIP-Version")]),e._v(" "),t("p",[e._v("正在使用的"),t("code",[e._v("SIP")]),e._v("版本，遵循"),t("code",[e._v("[H3.1]")]),e._v("关于版本订购、合规要求和版本号升级，虽然大小写不敏感，但是实际实现的时候都是使用大写发送")]),e._v(" "),t("h3",{attrs:{id:"状态行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#状态行"}},[e._v("#")]),e._v(" 状态行")]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Status-Line = SIP-Version SP Status-Code SP Reason-Phrase CRLF\n")])])]),t("p",[e._v("这里的 "),t("code",[e._v("SP")]),e._v("表示空格，以"),t("code",[e._v("CRLF")]),e._v("作为结束标志。除末尾的"),t("code",[e._v("CRLF")]),e._v("之外，不允许带有其他的"),t("code",[e._v("CR")]),e._v("或者"),t("code",[e._v("LF")])]),e._v(" "),t("h4",{attrs:{id:"sip-version-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sip-version-2"}},[e._v("#")]),e._v(" SIP-Version")]),e._v(" "),t("p",[e._v("正在使用的"),t("code",[e._v("SIP")]),e._v("版本，遵循"),t("code",[e._v("[H3.1]")]),e._v("关于版本订购、合规要求和版本号升级，虽然大小写不敏感，但是实际实现的时候都是使用大写发送")]),e._v(" "),t("h4",{attrs:{id:"status-code"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#status-code"}},[e._v("#")]),e._v(" Status-Code")]),e._v(" "),t("p",[e._v("状态码，3位10进制数值，用于标识请求结果，第一位(即最高位)用于标识一类状态，可取的状态码请参考"),t("RouterLink",{attrs:{to:"/sip/status_code.html"}},[e._v("SIP协议之3-状态码")]),e._v("一章")],1),e._v(" "),t("h4",{attrs:{id:"reason-phrase"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#reason-phrase"}},[e._v("#")]),e._v(" Reason-Phrase")]),e._v(" "),t("p",[e._v("状态码对应的描述信息, 请参考 "),t("code",[e._v("Stauts-Code")])]),e._v(" "),t("h2",{attrs:{id:"消息头部"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#消息头部"}},[e._v("#")]),e._v(" 消息头部")]),e._v(" "),t("p",[t("code",[e._v("SIP")]),e._v("头字段在语法和语义上都与 "),t("code",[e._v("HTTP")]),e._v("头字段相似，消息头部按键值对的形式给出，以"),t("code",[e._v("CRLF")]),e._v("结尾，形式如下：")]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v(" field-name: field-value\n")])])]),t("p",[e._v("冒号两端可以跟着任意数量的空格，但是建议做法是冒号前没有空格，冒号后跟一个空格")]),e._v(" "),t("p",[e._v("消息头部，也可以使用如下形式，其中"),t("code",[e._v(";")]),e._v("将作为分隔符")]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v(" field-name: field-value *(;parameter-name=parameter-value)\n")])])]),t("p",[e._v("头部的最小集合为： "),t("code",[e._v("To")]),e._v(", "),t("code",[e._v("From")]),e._v(", "),t("code",[e._v("CSeq")]),e._v(", "),t("code",[e._v("Call-ID")]),e._v(", "),t("code",[e._v("Max-Forwards")]),e._v(", 以及"),t("code",[e._v("Via")])]),e._v(" "),t("h3",{attrs:{id:"request-uri-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#request-uri-2"}},[e._v("#")]),e._v(" Request-URI")]),e._v(" "),t("p",[e._v("消息的初始 "),t("code",[e._v("Request-URI")]),e._v(" 应设置为 "),t("code",[e._v("To")]),e._v("字段中 "),t("code",[e._v("URI")]),e._v("的值")]),e._v(" "),t("h3",{attrs:{id:"via"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#via"}},[e._v("#")]),e._v(" Via")]),e._v(" "),t("p",[t("code",[e._v("Via")]),e._v("头部被用于标识事务的传输，以及标识响应被发送的位置，仅在选择用于到达下一跳的传输之后才添加 "),t("code",[e._v("Via")]),e._v("标头字段值")]),e._v(" "),t("p",[e._v("当"),t("code",[e._v("UAC")]),e._v("创建一个请求时，必须在请求中插入一个"),t("code",[e._v("Via")]),e._v("头部，"),t("code",[e._v("Via")]),e._v("头部中的协议名和协议版本必须分别是"),t("code",[e._v("SIP")]),e._v("和"),t("code",[e._v("2.0")]),e._v("，并且必须带有一个"),t("code",[e._v("branch")]),e._v("的参数")]),e._v(" "),t("p",[t("code",[e._v("branch")]),e._v("参数值用于标识该请求创建的事务，客户端和服务端都需要这个参数，对于 "),t("code",[e._v("UA")]),e._v("发送的所有请求，"),t("code",[e._v("branch")]),e._v("参数值在空间和时间上必须是唯一的, 此规则的例外情况是"),t("code",[e._v("CANCEL")]),e._v("响应和非"),t("code",[e._v("2xx")]),e._v("的"),t("code",[e._v("ACK")]),e._v("响应, 对于"),t("code",[e._v("CANCEL")]),e._v("响应"),t("code",[e._v("branch")]),e._v("参数值用于取消请求，对于非 "),t("code",[e._v("2xx")]),e._v("的 "),t("code",[e._v("ACK")]),e._v("响应也将具有与其确认其响应的 "),t("code",[e._v("INVITE")]),e._v(" 相同的"),t("code",[e._v("branch")]),e._v("参数值")]),e._v(" "),t("p",[t("code",[e._v("branch")]),e._v("参数值必须以"),t("code",[e._v("z9hG4bK")]),e._v("字符串开始(这7个字符可以认为是魔数)")]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Via: SIP/2.0/UDP 10.100.70.17:15060;branch=z9hG4bK2H34JI5OJ3AdsE3hN50000000000734226\n")])])]),t("h3",{attrs:{id:"to"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#to"}},[e._v("#")]),e._v(" To")]),e._v(" "),t("p",[t("code",[e._v("To")]),e._v("标头字段首先指定请求的所需的“逻辑”接收者，或者作为该请求目标的用户或资源的记录地址。"),t("code",[e._v("To")]),e._v("域中有可能是也有可能不是请求的最终接收者")]),e._v(" "),t("p",[e._v("所有的"),t("code",[e._v("SIP")]),e._v("实现必须支持"),t("code",[e._v("SIP URI")]),e._v("格式，任何支持"),t("code",[e._v("TLS")]),e._v("的"),t("code",[e._v("SIP")]),e._v("实现必须支持"),t("code",[e._v("SIPS URI")]),e._v("格式")]),e._v(" "),t("p",[t("code",[e._v("To")]),e._v("域允许带有显示名")]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("To: &lt;sip:10001@192.168.60.126:5060>;tag=0132456789\n")])])]),t("h3",{attrs:{id:"from"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#from"}},[e._v("#")]),e._v(" From")]),e._v(" "),t("p",[t("code",[e._v("From")]),e._v("头部指示发起请求的逻辑实体，有可能是用户的地址记录，和"),t("code",[e._v("To")]),e._v("域类似，包含了一个"),t("code",[e._v("URI")]),e._v("以及可选的显示名。"),t("code",[e._v("From")]),e._v("域用于确定请求应用哪些处理规则")]),e._v(" "),t("p",[t("code",[e._v("From")]),e._v('域允许带有显示名, 如果客户端身份需要保持隐藏，则显示名应该使用"Anonymous"以及语法正确但无意义的'),t("code",[e._v("URI")])]),e._v(" "),t("p",[t("code",[e._v("From")]),e._v("域必须包含一个新的由"),t("code",[e._v("UAC")]),e._v("选择的"),t("code",[e._v("tag")]),e._v("参数")]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("From: &lt;sip:10001@192.168.60.126>;tag=0132456789\n")])])]),t("h3",{attrs:{id:"call-id"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#call-id"}},[e._v("#")]),e._v(" Call-ID")]),e._v(" "),t("p",[t("code",[e._v("Call-ID")]),e._v("头部充当将一系列消息组合在一起的唯一标识符，在一个对话中，对于任意"),t("code",[e._v("UA")]),e._v("，发送的所有请求和响应消息中"),t("code",[e._v("Call-ID")]),e._v("必须一致，"),t("code",[e._v("UA")]),e._v("的每次注册都应该相同")]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Call-ID: 0123456789\n")])])]),t("h3",{attrs:{id:"cseq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cseq"}},[e._v("#")]),e._v(" CSeq")]),e._v(" "),t("p",[e._v("序列号，用于识别和排序事务，它包含了一个序列号和方法，方法必须比配请求(请求行中的"),t("code",[e._v("Method")]),e._v(")")]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("CSeq: &lt;sequence number> &lt;Method>\n")])])]),t("p",[e._v("对于对话之外的非"),t("code",[e._v("REGISTER")]),e._v("请求，序列号的值可以任意值，序列号必须是一个32位无符号整数，并且必须小于"),t("code",[e._v("2 ^ 31")])]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("CSeq: 2 REGISTER\n")])])]),t("h3",{attrs:{id:"contact"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#contact"}},[e._v("#")]),e._v(" Contact")]),e._v(" "),t("p",[t("code",[e._v("Contact")]),e._v("头部提供"),t("code",[e._v("SIP")]),e._v("或者"),t("code",[e._v("SIPS URI")]),e._v("，可以通过这个值来联系"),t("code",[e._v("UA")]),e._v("特定实例，并进行后续的请求，"),t("code",[e._v("Contact")]),e._v("必须存在，并且在任何可能导致建立对话的请求中仅包含一个"),t("code",[e._v("SIP")]),e._v("或"),t("code",[e._v("SIP URI")])]),e._v(" "),t("h3",{attrs:{id:"user-agent"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#user-agent"}},[e._v("#")]),e._v(" User-Agent")]),e._v(" "),t("h3",{attrs:{id:"content-length"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#content-length"}},[e._v("#")]),e._v(" Content-Length")]),e._v(" "),t("p",[e._v("用于标识消息主体部分长度，消息中不带有消息主体时，取值为0")]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Content-Length: 0\n")])])]),t("h3",{attrs:{id:"content-type"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#content-type"}},[e._v("#")]),e._v(" Content-Type")]),e._v(" "),t("p",[e._v("用于标识消息主体的类型描述")]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Content-Type: application/sdp\n")])])]),t("h3",{attrs:{id:"max-forwards"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#max-forwards"}},[e._v("#")]),e._v(" Max-Forwards")]),e._v(" "),t("p",[e._v("指定一个请求发送到目的地的最大跳数，由一个整数组成，每经过一跳，自动减一，当"),t("code",[e._v("Max-Forwards")]),e._v("的值在到达目的地前变为0，则返回一个"),t("code",[e._v("483")]),e._v("响应")]),e._v(" "),t("p",[t("code",[e._v("UAC")]),e._v("必须在每个请求中都插入一个初始值为"),t("code",[e._v("70")]),e._v("的"),t("code",[e._v("Max-Forwards")]),e._v("域")]),e._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v(" Max-Forwards: 70\n")])])]),t("h3",{attrs:{id:"supported"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#supported"}},[e._v("#")]),e._v(" Supported")]),e._v(" "),t("p",[t("code",[e._v("Supported")]),e._v(" 域列举出"),t("RouterLink",{attrs:{to:"/sip/SIP协议之2-名词定义.html"}},[t("code",[e._v("UAC")])]),e._v("或"),t("RouterLink",{attrs:{to:"/sip/SIP协议之2-名词定义.html"}},[t("code",[e._v("UAS")])]),e._v("支持的所有扩展, 当"),t("code",[e._v("UAC")]),e._v("支持扩展的时候使用")],1),e._v(" "),t("h2",{attrs:{id:"消息主体"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#消息主体"}},[e._v("#")]),e._v(" 消息主体")]),e._v(" "),t("p",[t("code",[e._v("SIP")]),e._v("消息消息主体部分，里面一般封装其他类型协议，由"),t("code",[e._v("Content-Type")]),e._v("和"),t("code",[e._v("Content-Length")]),e._v("分别指示消息主体的类型和长度，可选")])])}),[],!1,null,null,null);t.default=_.exports}}]);